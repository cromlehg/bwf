# BWF projects operator web-service
![BWF](logo.png "BWF")

### Требования
1. Ubuntu 18+
2. ps
3. useradd

### Описание

Осуществляет управление за проектами сделанынми на базе BWF кода.
BWF based проект в развернутом виде должен отвечать следующим требованиям

1. Иметь пользователя в системе <user>
2. Должен быть расположен в папке /home/<user>/bwf/env-<project-number>/ , где <project-number> - уникальный порядковый номер. Далее - это базовая папка среды

#### Струкутура базовой папки среды
Папка делится на prod рабочие версии и reserv - резервные копии. В каждой папке
могут находится несколько приложений (в составе проекта их может работать много). 
У каждого приложения есть репозиторий из которого происходит обновление, собраный рабочий проект,
а также папка с файлами, которыми оперирует проект. В папке резерва структура практически такая же.
За искобчением того что присутсвует время <datetime> формирования резерва и могут отсуствовать любые
части. 

Резевр баз данных имеет свои номер, посклольку в общем случае одному приложению могут соответсвовать 
несколько баз данных.

1. /prod/instance-<app-number>/repo - github репозиторий 
2. /prod/instance-<app-number>/build - собраный рабочий проект
3. /prod/instance-<app-number>/storage - хранение файлов проекта
4. /reserv/<datetime>/instance-<app-number>/repo - github репозиторий 
5. /reserv/<datetime>/instance-<app-number>/build - собраный рабочий проект
6. /reserv/<datetime>/instance-<app-number>/storage - хранение файлов проекта
7. /reserv/<datetime>/db-<db-number>/ - хранение файлов баз данных

#### Сущности системы:
1. Пользователь - это именно пользователь системы
2. Проект - на одного пользователя может быть несколько проектов
3. Приложение - bwf based запускаемый сервис в контексте одного проекта

##### Создание пользователя:

__Система должна работать от пользователя в группе sudoers__

Перед созданием пользователя система акутализирует информацию обо всех пользователях.
1. Чиатет пользователей системы
2. Сравинивает есть ли они в базе 
3. Если нет, то доблавляет с соответсвующим флагом. Если в базе есть пользователи, которых нет в системе, то помечает их как проблемные, если по ним есть проекты, если проектов нет, то удаляет наверное.

Создание пользователя происходит с помощью утилиты adduser. 

sudo useradd -m -p $(openssl passwd <password>) <username>  

Нужно найти способ шифровать на стороне бэкенда. 
А также способ исполнять комманды добавления пользователя без пароля судоера

Как происходит создание:
1. Вводим пароль от пользователя от которого работает operator
2. echo <operatoruserpassword> | sudo -S useradd -m -p $(openssl passwd <password>) <user>
3. Читаем пользователей системы, если появился, то обновляем базу


